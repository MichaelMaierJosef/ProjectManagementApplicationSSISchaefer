@model ProjectManagementApplication.Models.UserStory
@using Microsoft.AspNetCore.Identity

@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<style>
    body {
        background: white;
    }

    .userstoryItem:hover {
        cursor: pointer;
    }

    .sendtoback {
        z-index: -3;
    }

    .hoverBorder {
        border: 1px solid;
        border-color: transparent;
    }

        .hoverBorder:hover {
            border: 1px solid #dcdfe4;
        }



    .employee {
        background-color: #EFE407;
    }

        .employee i {
            opacity: 0%;
            transition: opacity .5s;
        }

            .employee i:hover {
                opacity: 100%
            }



    .admin {
        background-color: firebrick;
    }

        .admin i {
            opacity: 0%;
            transition: opacity .5s;
        }

            .admin i:hover {
                opacity: 100%
            }

    #routeLink {
        color: black;
    }

        #routeLink:hover {
            color: blue;
        }

    .linkState {
        font-size: 20px;
    }

</style>
<script type="text/javascript" src="~/js/userStory.js"></script>

<meta charset="utf-8" />

<div id="topNavigation" class="me-2 d-flex justify-content-end">

    <nav id="linkState" class="me-auto p-2">
        <span>/</span>
        <a href="../" class="routeLink">Projects</a>
        <span>/</span>
        <a class="text-reset"><u>@ViewBag.currentProjectName</u></a>
    </nav>

    <div class="input-group border-0 w-25 rounded-8 mb-4" style="background-color: #EFEDED">
        <span class="input-group-text border-0" id="search-addon">
            <i class="fas fa-search"></i>
        </span>
        <input type="search"
               class="form-control border-0 bg-transparent autocomplete-input"
               placeholder=""
               aria-describedby="search-addon"
               id="keyWordInput" oninput="filterPrjectlist()"
               style="border-radius: 20px" />
    </div>
</div>

<!--Input Data for UserStory-->
<h2 class="mb-3 text-black">@ViewBag.currentProjectName</h2>

<div class="d-flex mt-2 mb-5">
    <div class="d-flex flex-column me-4">
        <div id="status" class="pb-3">

            <div class="d-flex rounded-3" style="background-color: #EFEDED; border-bottom: 5px solid #00EFFF">
                <h4 class="my-2 mx-3 me-5" id="statusTitle">Product Backlog</h4>
            </div>


        </div>
        @{
            foreach (UserStory userstory in ViewBag.UserStorys)
            {
                        <div class="userstoryItem my-2 rounded-6" style="background-color:#EFEDED" draggable="true">
                            <div onclick="showDetailView('@userstory.name', '@userstory.description', '@userstory.startDate.ToString().Split(' ')[0]', '@userstory.endDate.ToString().Split(' ')[0]', '@userstory.id', '@userstory.state')">
                                <h5 class="mt-3 mx-3" id="taskTitle">@userstory.name</h5>
                                <form asp-controller="UserStory" asp-action="ChangeStateUserStory" method="post" asp-route-storyid="@userstory.id" asp-route-pid="@ViewBag.currentProjectId" asp-route-pName="@ViewBag.currentProjectName">
                                    <button type="submit" style="padding: 0;border: none;background: none;" data-mdb-ripple-color="dark">
                                    @if(userstory.state == 0)
                                    {
                                        <div style="width: 5px; height: 5px; background-color:red" class="btn btn-lg rounded-5 px-3 ms-auto"></div>
                                    }else{
                                        <div style="width: 5px; height: 5px; background-color:green" class="btn btn-lg rounded-5 px-3 ms-auto"></div>
                                    }
                                    </button>
                                </form>
                                <div class="d-flex my-2 mx-3">
                                    <div class="d-flex flex-column bg-transparent me-2">
                                        <div class="me-3">
                                            <i class="fas fa-calendar trailing"></i>
                                            <span>Start Date</span>
                                        </div>
                                        <span>@userstory.startDate.ToString().Split(' ')[0]</span>
                                    </div>
                                    <div class="bg-transparent d-flex flex-column">
                                        <div>
                                            <i class="fas fa-calendar trailing"></i>
                                            <span>Due Date</span>
                                        </div>
                                        <span>@userstory.endDate.ToString().Split(' ')[0]</span>
                                    </div>
                                </div>

                                <div class="my-2 mb-3">

                                    <div class="bg-transparent mx-3">
                                        <i class="fas fa-clipboard-check trailing my-auto"></i>
                                        <label class="form-labelbCreateEdit my-auto" for="progressBar">Progress</label>
                                    </div>

                                    <div class="progress my-2 mx-3 bg-white rounded-8" id="progressBar" style="height:15px">
                                        <div class="progress-bar"
                                         role="progressbar"
                                         style="width: 10%;"
                                         aria-valuenow="0"
                                         aria-valuemin="0"
                                         aria-valuemax="100"></div>
                                        <div class="progress-bar bg-success"
                                         role="progressbar"
                                         style="width: 10%;"
                                         aria-valuenow="0"
                                         aria-valuemin="0"
                                         aria-valuemax="100"></div>
                                        <div class="progress-bar bg-info"
                                         role="progressbar"
                                         style="width: 10%;"
                                         aria-valuenow="0"
                                         aria-valuemin="0"
                                         aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
            }
        }
        <div class="my-2 d-flex justify-content-center w-100">
            <button id="btnAddUserstory" type="button" class="btn btn-link text-black btn-floating" data-mdb-toggle="modal" data-mdb-target="#createModal">
                <i class="fas fa-plus fa-2x"></i>
            </button>
        </div>
    </div>
</div>

<input id="input-id" type="file" class="file" data-preview-file-type="text">


<!-- Modal Info -->
<div class="modal fade"
     id="infoModal"
     data-mdb-keyboard="false"
     tabindex="-1"
     aria-labelledby="infoModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header p-0" style="border-bottom: 1px solid #dcdfe4;">
                <div class="d-flex flex-column justify-content-start w-100">
                    <div class="d-flex py-2 px-2" style="border-radius:10px 10px 0 0; background-color:#eff0f3; border-bottom: 1px solid #dcdfe4;">
                        <div class="py-1 px-3 bg-white rounded-6">
                            <!--Path-->
                            <nav id="linkState" class="me-auto">
                                <span>/</span>
                                <a href="../" class="routeLink">Projects</a>
                                <span>/</span>
                                <a data-mdb-dismiss="modal" class="routeLink">@ViewBag.currentProjectName</a>
                                <span>/</span>
                                <a class="text-reset"><u id="userStoryTitle"></u></a>
                            </nav>
                        </div>
                        <!--Close-->
                        <button type="button" class="btn btn-link text-black btn-floating bg-white align-self-end ms-auto my-auto" data-mdb-dismiss="modal">
                            <i class="fas fa-times fa-2x"></i>
                        </button>
                    </div>

                    <!--Mitarbeiter-->
                    <div class="d-flex my-2">
                        <i class="fas fa-user-alt text-black fa-2x my-auto mx-2 ms-4"></i>

                        <!--Mitarbeiter Item-->
                        <div class="admin d-flex justify-content-around rounded-8 mx-1 my-auto">
                            <button type="submit" class="btn btn-link text-black btn-floating" disabled>
                                <i class="fas fa-times" style="font-size: 1.5em;"></i>
                            </button>
                            <h6 class="my-auto mx-1 text-black">MrKuh</h6>
                            <button type="button" class="btn btn-link text-black bg-transparent btn-floating">
                                <i class="fas fa-times" style="font-size: 1.5em;"></i>
                            </button>
                        </div>

                        <!--Add Mitarbeiter-->
                        <button type="button" class="btn btn-link text-black btn-floating" data-dismiss="modal" onclick="openAddUserModal();">
                            <i class="fas fa-plus fa-2x"></i>
                        </button>
                    </div>
                </div>
            </div>
            <!--Body-->
            <div class="modal-body p-0">
                <form id="editForm" asp-action="EditUserStory" asp-route-pid="@ViewBag.currentProjectId" asp-route-pName="@ViewBag.currentProjectName" method="post">
                    <input asp-for="id" id="storyId" hidden />
                    <input asp-for="state" id="storyState" type="text" hidden />
                    <div class="container-fluid p-0">
                        <div class="d-flex align-items-start">
                            <div class="col d-flex flex-column px-3" style=" border-right: .5px solid #dcdfe4;">
                                <div class="d-flex my-2 mt-3">
                                    <!--Story Titel-->
                                    <div class="bg-transparent flex-fill">
                                        <input id="storyTitleInput" asp-for="name" style="font-size: 26px;font-weight: 400;line-height: 34px;" type="text" class="form-control form-control-lg text-black hoverBorder px-2" value="" />
                                    </div>
                                </div>
                                <!--Description-->
                                <div class="bg-transparent mb-2">
                                    <textarea id="storyDescriptionInput" asp-for="description" style="font-size: 16px;" class="form-control form-control-lg hoverBorder px-2" rows="8"></textarea>
                                </div>
                            </div>
                            <div class="col d-flex flex-column px-3 h-100" style=" border-left: .5px solid #dcdfe4;">
                                <div class="d-flex mt-2">
                                    <div class="d-flex rounded-5">
                                        <!--Start Date-->
                                        <div class="d-flex me-2">
                                            <i class="fas fa-calendar trailing my-auto me-1 text-black"></i>
                                            <label class="form-label text-nowrap my-auto me-1 text-black" for="storyStartDate">Start-Date</label>
                                            <input id="storyStartDate" asp-for="startDate" type="text" size="8" class="form-control datePicker px-2 bg-transparent hoverBorder" />
                                        </div>
                                        <!--End Date-->
                                        <div class="d-flex me-2">
                                            <i class="fas fa-calendar trailing my-auto me-1 text-black"></i>
                                            <label class="form-label text-nowrap my-auto me-1 text-black" for="storyEndDate">End-Date</label>
                                            <input id="storyEndDate" asp-for="endDate" type="text" size="8" class="form-control datePicker px-2 bg-transparent hoverBorder" />
                                        </div>
                                    </div>
                                    <!--Complete Button-->
                                    <form asp-action="DeleteStory" asp-route-pid="@ViewBag.currentProjectId" asp-route-pname="@ViewBag.currentProjectName">
                                    <button type="submit" class="btn btn-outline-success btn-lg rounded-5 px-3 ms-auto" data-mdb-ripple-color="dark"><i class="fas fa-sign-out-alt fa-3x"></i></button>
                                    </form>
                                </div>
                                <div class="d-flex flex-column">
                                    <div class="my-2 mb-3">
                                        <div class="bg-transparent text-black">
                                            <i class="fas fa-clipboard-check trailing my-auto"></i>
                                            <label class="form-labelbCreateEdit my-auto" for="progressBar">Progress</label>
                                        </div>
                                        <div class="progress my-2 rounded-8" id="progressBar" style="height:15px;background-color: #dcdfe4">
                                            <div class="progress-bar bg-warning"
                                                 role="progressbar"
                                                 style="width: 0%;"
                                                 aria-valuenow="0"
                                                 aria-valuemin="0"
                                                 aria-valuemax="100"></div>
                                            <div class="progress-bar bg-success"
                                                 role="progressbar"
                                                 style="width: 0%;"
                                                 aria-valuenow="0"
                                                 aria-valuemin="0"
                                                 aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex flex-column  my-2 mt-auto">
                                    <form asp-controller="UserStory" asp-action="MultiUpload" asp-route-projectid="@ViewBag.currentProjectId" asp-route-projectname="@ViewBag.currentProjectName" method="post" enctype="multipart/form-data">
                                        <label class="form-label">Select Multiple Files</label>
                                        <div class="d-flex">
                                            <input asp-for="id" id="userStoryId" hidden />
                                            <input asp-for="Files" class="form-control" multiple />
                                            <span asp-validation-for="Files" class="text-danger"></span>
                                        </div>
                                        <div class="d-flex my-2">
                                            <button type="submit" class="btn btn-primary">Upload Files</button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                        </div>
                    </div>
                </form>
            </div>
            <!--<div class="modal-footer" style=" border-top: 1px solid #dcdfe4;">
                <button type="button" class="btn btn-link btn-lg text-success" data-mdb-dismiss="modal">SAVE</button>
            </div>-->
        </div>
    </div>
</div>

<!-- Modal Info -->
<div class="modal fade"
     id="infoModalAddUser"
     data-mdb-keyboard="false"
     tabindex="-1"
     aria-labelledby="infoModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header p-0" style="border-bottom: 1px solid #dcdfe4;">
                <div class="d-flex flex-column justify-content-start w-100">
                    <div class="d-flex py-2 px-2" style="border-radius:10px 10px 0 0; background-color:#eff0f3; border-bottom: 1px solid #dcdfe4;">
                        <div class="py-1 px-3 bg-white rounded-6">
                            <!--Path-->
                            <nav id="linkState" class="me-auto">
                                <span>/</span>
                                <a href="../" class="routeLink">Projects</a>
                                <span>/</span>
                                <a href="../" class="routeLink">@ViewBag.currentProjectName</a>
                                <span>/</span>
                                <a data-mdb-dismiss="modal" class="routeLink" id="userStoryTitleAdd"></a>
                                <span>/</span>
                                <a class="text-reset"><u>Add User</u></a>
                            </nav>
                        </div>
                        <!--Close-->
                        <button type="button" class="btn btn-link text-black btn-floating bg-white align-self-end ms-auto my-auto" data-mdb-dismiss="modal">
                            <i class="fas fa-times fa-2x"></i>
                        </button>
                    </div>

                    <div class="d-flex my-2">
                        <i class="fas fa-user-alt text-black fa-2x my-auto mx-2 ms-4"></i>
                        <h4>Mitarbeiter Hinzufuegen</h4>

                        <div class="modal-body p-0">

                            @{
                                List<IdentityUser> projectAllUser = new List<IdentityUser>();
                                projectAllUser = ViewBag.allUser;
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Mitarbeiter</th>
                                            <th>Hinzufügen</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{
                                            if (ViewBag.allUser != null)
                                            {
                                                foreach (IdentityUser user in projectAllUser)
                                                {
                                                    <tr>
                                                        <th>@user.UserName</th>
                                                        <th>

                                                            <!-- <form methoyd="post" asp-action="EditUserRoles" asp-controller="Project" asp-route-userId="@user.Id" asp-route-ProjectID="@ViewBag.ProjectID"> -->
                                                            <button type="button" onclick="editUserRoles('@user.Id', @ViewBag.ProjectID)" class="btn btn-link text-black btn-floating">
                                                                <i class="fas fa-plus fa-2x"></i>
                                                            </button>
                                                            <!-- </form> -->
                                                        </th>
                                                    </tr>
                                                }
                                            }
                                        }
                                    </tbody>
                                </table>
                            }
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>



<div class="modal fade"
     id="createModal"
     data-mdb-backdrop="static"
     data-mdb-keyboard="false"
     tabindex="-1"
     aria-labelledby="createModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <form id="crateForm" asp-action="CreateUserStory" asp-route-pid="@ViewBag.currentProjectId" asp-route-pName="@ViewBag.currentProjectName" method="post">
                <div class="modal-header" style=" border-bottom: 1px solid #dcdfe4;">
                    <h5 class="modal-title text-black" id="staticBackdropLabel">Create Userstory</h5>
                </div>
                <div class="modal-body  p-0">
                    <input asp-for="id" id="storyId" hidden />
                    <input asp-for="state" id="storyState" type="text" hidden />
                    <div class="container-fluid p-0">
                        <div class="d-flex align-items-start">

                            <div class="col d-flex flex-column px-3">
                                <div class="d-flex my-2 mt-3">
                                    <!--Story Titel-->
                                    <div class="d-flex flex-column flex-fill me-2 mt-auto mb-2">
                                        <div class="d-flex my-1">
                                            <label class="form-label flex-fill my-auto text-black" for="storyTitleInputDummy" style="font-size: 20px;">Story Title</label>
                                        </div>
                                        <div class="form-outline" style="border-color:#dcdfe4;">
                                            <input id="storyTitleInputDummy" asp-for="name" type="text" class="form-control form-control-lg text-black px-2" style="font-size: 26px;font-weight: 400;line-height: 34px;" />
                                        </div>
                                    </div>
                                    <!--Date-->
                                    <div class="d-flex p-1 me-2 rounded-5">
                                        <!--Start Date-->
                                        <div class="mx-1 p-1">
                                            <i class="fas fa-calendar trailing my-auto me-2 text-black"></i>
                                            <label class="form-label text-nowrap my-auto me-1 text-black" for="storyStartDateDummy" style="font-size: 18px;">Start-Date</label>
                                            <div class="form-outline" style="border-color:#dcdfe4;">
                                                <input id="storyStartDateDummy" asp-for="startDate" type="text" size="8" class="form-control form-control-lg datePicker px-2 bg-transparent" style="font-size: 26px;font-weight: 400;line-height: 34px;" />
                                            </div>
                                        </div>
                                        <!--End Date-->
                                        <div class="mx-1 p-1 px-2">
                                            <i class="fas fa-calendar trailing my-auto me-2 text-black"></i>
                                            <label class="form-label text-nowrap my-auto text-black" for="storyEndDateDummy" style="font-size: 18px;">End-Date</label>
                                            <div class="form-outline" style="border-color:#dcdfe4;">
                                                <input id="storyEndDateDummy" asp-for="endDate" type="text" size="8" class="form-control form-control-lg datePicker px-2 bg-transparent" style="font-size: 26px;font-weight: 400;line-height: 34px;" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--Description-->
                                <div class="d-flex flex-column my-2 mt-3">
                                    <div class="d-flex my-1">
                                        <i class="fas fa-info-circle trailing my-auto me-2 text-black"></i>
                                        <label class="form-label flex-fill my-auto text-black" for="storyDescriptionInputDummy" style="font-size: 18px;">Description</label>
                                    </div>
                                    <div class="form-outline" style="border-color:#dcdfe4;">
                                        <textarea id="storyDescriptionInputDummy" asp-for="description" style="font-size: 16px;" class="form-control form-control-lg px-2" rows="8"></textarea>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
                <div class="modal-footer" style=" border-top: 1px solid #dcdfe4;">
                    <button type="button" class="btn btn-link btn-lg text-dark" data-mdb-dismiss="modal">CANCEL</button>
                    <button type="submit" class="btn btn-link btn-lg text-success">CREATE</button>
                </div>
            </form>
        </div>
    </div>
</div>
